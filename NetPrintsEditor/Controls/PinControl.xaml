<UserControl x:Class="NetPrintsEditor.Controls.PinControl"
             xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
             xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
             xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006" 
             xmlns:d="http://schemas.microsoft.com/expression/blend/2008" 
             xmlns:local="clr-namespace:NetPrintsEditor.Controls"
             mc:Ignorable="d" 
             d:DesignHeight="20" d:DesignWidth="100" x:Name="pinWindow">

    <UserControl.Resources>
        <BooleanToVisibilityConverter x:Key="BoolToVis" />
    </UserControl.Resources>
    
    <Canvas x:Name="canvas" Height="20" MouseLeftButtonDown="Canvas_MouseLeftButtonDown">
        <Grid x:Name="grid" Width="110">
            <Grid.ColumnDefinitions>
                <ColumnDefinition Width="20"/>
                <ColumnDefinition Width="Auto" />
                <ColumnDefinition />
            </Grid.ColumnDefinitions>
            <Canvas x:Name="connector" Grid.Column="0" Width="20" Height="20">
                <Ellipse x:Name="ellipse" Width="20" Height="20" MouseMove="OnEllipseMouseMove" DragOver="OnEllipseDragOver" Drop="OnEllipseDrop" AllowDrop="True" StrokeThickness="3">
                    <Ellipse.Style>
                        <Style TargetType="{x:Type Ellipse}">
                            <Style.Triggers>
                                <Trigger Property="IsMouseOver" Value="True">
                                    <Setter Property="Stroke" Value="White" />
                                </Trigger>
                            </Style.Triggers>
                        </Style>
                    </Ellipse.Style>
                </Ellipse>
                <Path x:Name="cable" Visibility="{Binding ElementName=pinWindow, Path=Pin.IsConnected, Converter={StaticResource ResourceKey=BoolToVis}}" Stroke="#FFE0E0E0" Panel.ZIndex="1" StrokeThickness="4" IsHitTestVisible="False" StrokeStartLineCap="Round" StrokeEndLineCap="Round">
                    <Path.Data>
                        <PathGeometry>
                            <PathGeometry.Figures>
                                <PathFigureCollection>
                                    <PathFigure StartPoint="{Binding ElementName=pinWindow, Path=Pin.Position}">
                                        <PathFigure.Segments>
                                            <PathSegmentCollection>
                                                <BezierSegment 
                                            Point1="{Binding ElementName=pinWindow, Path=Pin.ConnectedCP1}" 
                                            Point2="{Binding ElementName=pinWindow, Path=Pin.ConnectedCP2}" 
                                            Point3="{Binding ElementName=pinWindow, Path=Pin.ConnectedPosition}" />
                                            </PathSegmentCollection>
                                        </PathFigure.Segments>
                                    </PathFigure>
                                </PathFigureCollection>
                            </PathGeometry.Figures>
                        </PathGeometry>
                    </Path.Data>
                </Path>
            </Canvas>
            <Label Grid.Column="1" x:Name="label" Content="{Binding ElementName=pinWindow, Path=Pin.Name}" FontFamily="Lucida Sans Unicode" FontSize="11" FontWeight="Bold" Foreground="#FFEEEEEE" VerticalContentAlignment="Stretch" />
            <TextBox Grid.Column="2" 
                     Text="{Binding ElementName=pinWindow, Path=Pin.UnconnectedValue}"
                     Visibility="{Binding ElementName=pinWindow, Path=Pin.IsUsingUnconnectedValue, Converter={StaticResource ResourceKey=BoolToVis}}"/>
        </Grid>

        
    </Canvas>
</UserControl>
